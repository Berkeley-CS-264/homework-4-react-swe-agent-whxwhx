\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{parskip}

\title{CS 264 HW: ReAct Agent for Software Engineering\\Report}
\author{Student}
\date{\today}

\begin{document}
\maketitle

\section{Overview}
This report describes improvements made to a minimal ReAct-style software engineering agent for the SWE-bench evaluation subset. The agent alternates between generating an action in a strict textual tool-call format and executing tools inside an isolated environment to produce a patch.

\section{Key Improvements}
\subsection{Match the model's chat training distribution}
The provided starter framework effectively places all history into a single large text blob, which can mismatch the distribution that modern chat models are trained on. I changed the agent to construct a \emph{multi-turn} conversation (a list of messages with roles), and then pass those messages directly to the OpenAI Chat Completions API so that the API applies the correct chat template (OpenAI ``harmony'' chat formatting) internally. In practice, this reduced instruction drift and improved tool-use stability.

\subsection{Repeat system instructions to improve long-context compliance}
When the context grows long, the model often starts producing ill-formed function calls (missing markers, missing argument blocks, etc.). To mitigate this, I repeat the system message at the end of each round (in addition to the normal system message at the start). This provides a fresh copy of the tool descriptions and the required response format near the end of the prompt, improving instruction-following and reducing parse errors.

\subsection{Make the end marker more forgiving}
A frequent failure mode was the model emitting the end marker with slightly different punctuation, e.g. forgetting the trailing dashes in:
\begin{quote}
\texttt{----END\_FUNCTION\_CALL----}
\end{quote}
To reduce brittleness, I changed the parser's end delimiter to the shorter prefix:
\begin{quote}
\texttt{----END\_FUNCTION\_CALL}
\end{quote}
This accepts both the full marker and common ``missing trailing dashes'' variants, which significantly reduced parse failures.

\section{Additional Engineering Guardrails}
\subsection{Typed tool arguments}
The textual tool-call format produces arguments as strings. Some tools (notably \texttt{replace\_in\_file}) require integer line numbers. I added automatic argument coercion based on the tool signature (e.g., converting \texttt{"266"} to \texttt{266} when an argument is annotated as \texttt{int}). This prevents common runtime errors such as comparisons between \texttt{str} and \texttt{int}.

\subsection{Test-modification guardrail}
SWE-bench evaluation disallows modifying or adding tests. The agent now detects changes to test paths (e.g., \texttt{tests/}, \texttt{test\_*.py}, \texttt{*\_test.py}) and automatically reverts/removes them, then instructs the model to re-implement the fix without touching tests.

\section{Evaluation Results}
The evaluation file reports:
\begin{itemize}[leftmargin=2em]
  \item Total instances: 20
  \item Submitted: 20
  \item Completed: 20
  \item Resolved: 11
  \item Unresolved: 9
  \item Empty patch: 0
  \item Error: 0
\end{itemize}

\subsection{Solved instances}
\begin{itemize}[leftmargin=2em]
  \item \texttt{astropy\_\_astropy-7166}
  \item \texttt{django\_\_django-11179}
  \item \texttt{django\_\_django-13297}
  \item \texttt{django\_\_django-13810}
  \item \texttt{django\_\_django-14053}
  \item \texttt{django\_\_django-16662}
  \item \texttt{django\_\_django-7530}
  \item \texttt{scikit-learn\_\_scikit-learn-26323}
  \item \texttt{sphinx-doc\_\_sphinx-9658}
  \item \texttt{sympy\_\_sympy-17655}
  \item \texttt{sympy\_\_sympy-24213}
\end{itemize}

\subsection{Unsolved instances}
\begin{itemize}[leftmargin=2em]
  \item \texttt{django\_\_django-10973}
  \item \texttt{django\_\_django-12406}
  \item \texttt{django\_\_django-14011}
  \item \texttt{django\_\_django-16631}
  \item \texttt{psf\_\_requests-1921}
  \item \texttt{psf\_\_requests-2931}
  \item \texttt{pytest-dev\_\_pytest-7490}
  \item \texttt{sphinx-doc\_\_sphinx-7590}
  \item \texttt{sphinx-doc\_\_sphinx-9230}
\end{itemize}

\section{Observation}
The most impactful improvements were prompt-format alignment (multi-turn chat) and robustness against formatting drift (repeating the system message at the end of each round and relaxing the end marker). Together, these changes reduced the rate of invalid tool-call outputs and improved overall stability when operating in long contexts.

\end{document}


